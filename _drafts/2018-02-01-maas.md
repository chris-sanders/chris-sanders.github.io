---
layout: post
title:  "MAAS for the home"
subtitle: "The unsupported configuration"
date:   2018-01-31 20:00:00 +0000
gh-repo: chris-sanders/maas-lxd
gh-badge: [star, fork, follow]
image: "/img/maas-logo.svg"
tags: [homelab, maas]
---

MAAS is designed to run in a data center where it expects to have control of DNS
and DHCP. The use of an external DHCP server is listed as 'may work but not
supported' in the MAAS documentation. This guide will describe how I configured
MAAS to coexist with a home router since I wanted to keep mine in use for DHCP
and DNS. Note, some of this will depend on the router allowing some advanced
configurations and not all routers will support it.

This will have some limitations but none of those limitations affect me in home
lab use today. One day I might switch my DNS and DHCP from the consumer grade
Asus I have today to a more robust solution. That's a project for another
post and another day, the configuration(s) I describe here are a good stop-gap
until that time.

## Installing MAAS

I've chosen to install MAAS in a LXD container. While this requires a minimal
amount of extra setup it allows me to migrate the LXD to another machine in the
future and keeps MAAS separated from anything else on the machine. I have a
small repository ([maas-lxd][maas-lxd]) with some scripts and profiles to help
set it up. You can also use the buttons at the top of this post to star or fork
the repository for later use. 

### MAAS-LXD

The README file from the [maas-lxd][maas-lxd] repository explains how to use it
but is intended to setup a self contained environment where LXD is providing
NAT (the LXD default). For the home lab we're going to modify that to use a
bridged setup since we want MAAS to receive PXE requests from the network.

#TODO: Run through LXD bridge setup
#TODO: Verify processes to get MAAS-LXD on the bridge

## PXE booting

In order for MAAS to commission a node and provide the operating system the
machine must PXE boot from MAAS. This means the router that is providing DHCP
will need to forward PXE requests to MAAS. Many consumer routers today will
allow this as an advanced setting. The router I'm currently using is the Asus
RT-AC88U.

#TODO: Document router config for PXE redirect
#TODO: Document router netmask setting for expanded subnet routing

## Configure machine

#TODO: preseed grub on both drives
#TODO: preseed Bios boot on GPT

[maas]: https://maas.io/
[maas-lxd]: https://github.com/chris-sanders/maas-lxd
